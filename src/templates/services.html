{% extends "base.html" %}

{% block title %}
    Services
{% endblock %}

{% if colorTheme == "emerald-400" %}
    {% set tableRowHoverColor = "oklch(90.5% 0.093 164.15)" %} <!-- emerald 200 -->
    {% set clients_iconHoverColor = "oklch(59.6% 0.145 163.225)" %} <!-- emerald 600 -->
    {% set clients_closeFormIconHoverColor = "oklch(76.5% 0.177 163.223)" %} <!-- emerald 400 -->
{% elif colorTheme == "blue-400" %}
    {% set tableRowHoverColor = "oklch(88.2% 0.059 254.128)" %} <!-- blue 200 -->
    {% set clients_iconHoverColor = "oklch(54.6% 0.245 262.881)" %} <!-- blue 600 -->
    {% set clients_closeFormIconHoverColor = "oklch(70.7% 0.165 254.624)" %} <!-- blue 400 -->
{% elif colorTheme == "violet-400" %}
    {% set tableRowHoverColor = "oklch(89.4% 0.057 293.283)" %} <!-- violet 200 -->
    {% set clients_iconHoverColor = "oklch(54.1% 0.281 293.009)" %} <!-- violet 600 -->
    {% set clients_closeFormIconHoverColor = "oklch(70.2% 0.183 293.541)" %} <!-- violet 400 -->
{% elif colorTheme == "fuchsia-400" %}
    {% set tableRowHoverColor = "oklch(90.3% 0.076 319.62)" %} <!-- fuchsia 200 -->
    {% set clients_iconHoverColor = "oklch(59.1% 0.293 322.896)" %} <!-- fuchsia 600 -->
    {% set clients_closeFormIconHoverColor = "oklch(74% 0.238 322.16)" %} <!-- fuchsia 400 -->
{% elif colorTheme == "rose-400" %}
    {% set tableRowHoverColor = "oklch(89.2% 0.058 10.001)" %} <!-- rose 200 -->
    {% set clients_iconHoverColor = "oklch(58.6% 0.253 17.585)" %} <!-- rose 600 -->
    {% set clients_closeFormIconHoverColor = "oklch(71.2% 0.194 13.428)" %} <!-- rose 400 -->
{% endif %}

{% block css %}
    <style>
        #tbody_all-services tr:hover {
            background-color: {{ tableRowHoverColor }};
        }

        .icon-wrapper {
            position: relative;
            display: inline-block;
            width: 1.25rem;
            height: 1.25rem;
        }

        .form-icon-wrapper {
            position: relative;
            display: inline-block;
            width: 1.875rem;
            height: 1.875rem;
        }

        .icon, .form-icon-wrapper .icon {
            position: absolute;
            top: 0;
            left: 0;
            transition: opacity 0.2s ease;
        }

        .icon.solid, .form-icon-wrapper .icon.solid {
            opacity: 0; /* hide solid by default */
            transition: opacity 0.3s;
        }

        .icon-wrapper:hover .icon.solid, .form-icon-wrapper:hover .icon.solid { opacity: 1; }
        .icon-wrapper:hover .icon.outline, .form-icon-wrapper:hover .icon.outline { opacity: 0; }
    </style>
{% endblock %}

{% block content %}
    <!-- My Services -->
    <div class="flex flex-col">
        <div class="mb-4 flex flex-row justify-between">
            <h1 class="text-3xl font-bold">My Services</h1>
            <button id="btn_show-new-service-form" class="h-[2.25rem] pl-4 pr-4 bg-{{ colorTheme }} rounded-md text-base font-semibold cursor-pointer">New Service</button>
        </div>
        <!-- table of current services -->
        <div class="relative w-full h-full overflow-scroll flex flex-col bg-white shadow-md rounded-lg bg-clip-border">
            <table class="w-full min-w-max table-auto text-left">
                <thead>
                    <tr class="h-[2.25rem] bg-{{ colorTheme }} border-b">
                        <th class="w-[20%] p-4">Name</th>
                        <th class="w-[60%] p-4">Description</th>
                        <th class="w-[12%] p-4 text-center">Unit Price</th>
                        <th class="w-[8%] p-4"></th>
                    </tr>
                </thead>
                <tbody id="tbody_all-services">
                    {% for service in services %}
                    <tr class="h-[2.25rem]">
                        <td class="p-4">{{ service.name }}</td>
                        <td class="p-4">{{ service.description }}</td>
                        <td class="p-4 text-center">{{ service.get_formatted_unit_price() }}</td>
                        <td class="flex flex-row gap-4 p-4">
                            <!-- Edit Service Buttons -->
                            <button
                                id="btn_show-edit-service-form-{{ service.id }}"
                                data-name="{{ service.name }}"
                                data-description="{{ service.description }}"
                                data-unit-price="{{ service.unit_price }}"
                                data-service-id="{{ service.id }}"
                                class="cursor-pointer group"
                            >
                                <div class="icon-wrapper overflow-hidden flex-shrink-0">
                                    <span class="icon outline">{{ heroicon_outline("pencil", width="1.25rem", height="1.25rem") }}</span>
                                    <span class="icon solid">{{ heroicon_solid("pencil", width="1.25rem", height="1.25rem", color=clients_iconHoverColor) }}</span>
                                </div>
                            </button>
                            <!-- Remove Service Buttons -->
                            <button
                                id="btn_show-remove-service-form-{{ service.id }}"
                                data-name="{{ service.name }}"
                                data-description="{{ service.description }}"
                                data-service-id="{{ service.id }}"
                                class="cursor-pointer group"
                            >
                                <div class="icon-wrapper overflow-hidden flex-shrink-0">
                                    <span class="icon outline">{{ heroicon_outline("trash", width="1.25rem", height="1.25rem") }}</span>
                                    <span class="icon solid">{{ heroicon_solid("trash", width="1.25rem", height="1.25rem", color=clients_iconHoverColor) }}</span>
                                </div>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Service Form Dialog -->
    <dialog id="dialog_service-form" class="w-128 m-auto p-4 flex flex-col bg-gray-50 rounded-lg" hidden>
        <div class="mb-4 flex flex-row justify-between">
            <!-- Form Header -->
            <h2 id="h2_service-form-header" class="text-2xl font-bold"></h2>
            <button id="btn_hide-service-form" class="cursor-pointer group">
                <div class="form-icon-wrapper overflow-hidden flex-shrink-0">
                    <span class="icon outline">{{ heroicon_outline("x-circle", width="1.875rem", height="1.875rem") }}</span>
                    <span class="icon solid">{{ heroicon_solid("x-circle", width="1.875rem", height="1.875rem", color=clients_closeFormIconHoverColor) }}</span>
                </div>
            </button>
        </div>
        <!-- Form -->
        <form id="form_service-form" method="post">
            <div class="mb-4 flex flex-col gap-2">
                <div class="flex flex-row gap-8 justify-between">
                    <!-- Name -->
                    <div class="w-3/4 flex flex-col">
                        <label for="input_service-form_name" class="pr-2 text-base">Name:</label>
                        <input type="text" id="input_service-form_name" name="name" class="h-[2.25rem] p-2 border rounded-md text-base" required>
                    </div>
                    <!-- Unit Price -->
                    <div class="w-1/4 flex flex-col">
                        <label for="input_service-form_unit-price" class="pr-2 text-base">Unit Price:</label>
                        <input type="text" id="input_service-form_unit-price" name="unit-price" class="h-[2.25rem] p-2 border rounded-md text-base" required>
                    </div>
                </div>
                <!-- Description -->
                <div class="flex flex-col">
                    <label for="textarea_service-form_description" class="pr-2 text-base">Description:</label>
                    <textarea id="textarea_service-form_description" name="description" class="h-[10rem] p-2 border rounded-md text-base"></textarea>
                </div>
            </div>
            <!-- hidden input storing Service ID -->
            <input type="text" id="input_service-form_service-id" name="service-id" hidden>
            <!-- Form Submit Button -->
            <div class="flex justify-end">
                <button id="btn_submit-service-form" type="submit" class="h-[2.25rem] pl-4 pr-4 bg-{{ colorTheme }} rounded-md text-base font-semibold cursor-pointer"></button>
            </div>
        </form>
    </dialog>

    <!-- Remove Service Form Dialog -->
     <dialog id="dialog_remove-service-form" class="w-96 m-auto p-4 flex flex-col bg-gray-50 rounded-lg" hidden>
        <!-- Form Header -->
        <div class="mb-4 flex flex-col gap-2 justify-between">
            <h2 class="text-2xl font-bold">Remove Service</h2>
            <p class="text-base">Are you sure you want to remove this service?</p>
        </div>
        <!-- Service Information -->
        <div class="mb-4 flex flex-col">
            <p id="p_remove-service-form_name-placeholder" class="pl-4"></p>
            <p id="p_remove-service-form_description-placeholder" class="pl-4"></p>
        </div>
        <!-- Form -->
        <form id="form_remove-service-form" action="/services/remove_service" method="post">
            <!-- hidden input storing Service ID -->
            <input type="text" id="input_remove-service-form_service-id" name="service-id" hidden>
            <div class="flex flex-row gap-4 justify-end">
                <!-- Form Submit Button -->
                <button type="submit" class="h-[2.25rem] pl-4 pr-4 bg-red-500 rounded-md text-base font-semibold cursor-pointer">Delete Service</button>
                <!-- Cancel Button -->
                <button id="btn_hide-remove-service-form" type="button" class="h-[2.25rem] pl-4 pr-4 bg-{{ colorTheme }} rounded-md text-base font-semibold cursor-pointer">Cancel</button>
            </div>
        </form>
    </dialog>
{% endblock %}

{% block javascript %}
    <script src="/static/js/services.js"></script>
{% endblock %}